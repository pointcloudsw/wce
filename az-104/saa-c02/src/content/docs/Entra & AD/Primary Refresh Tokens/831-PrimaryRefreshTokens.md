---
title: Microsoft Entra Primary Refresh Tokens (PRTs)
sidebar:
    order: 831
---
### Overview
A Primary Refresh Token (PRT) is a key artifact of Microsoft Entra authentication on Windows 10 or newer, Windows Server 2016 and later versions, iOS, and Android devices. It's a JSON Web Token (JWT) specially issued to Microsoft first party token brokers to enable single sign-on (SSO) across the applications used on those devices. A PRT is an opaque blob sent from Microsoft Entra whose contents aren't known to any client components. You can't see what's inside a PRT.

### Terminology
The following Windows components play a key role in requesting and using a PRT:
- **Cloud Authentication Provider (CloudAP)**: CloudAP is the modern authentication provider for Windows sign in, that verifies users logging to a Windows 10 or newer device. CloudAP provides a plugin framework that identity providers can build on to enable authentication to Windows using that identity provider's credentials.
- **Web Account Manager (WAM)**: WAM is the default token broker on Windows 10 or newer devices. WAM also provides a plugin framework that identity providers can build on and enable SSO to their applications relying on that identity provider.
- Microsoft Entra CloudAP plugin: A Microsoft Entra specific plugin built on the CloudAP framework that verifies user credentials with Microsoft Entra ID during Windows sign in.
- **Microsoft Entra WAM plugin**: A Microsoft Entra specific plugin built on the WAM framework that enables SSO to applications that rely on Microsoft Entra ID for authentication.
- **Dsreg**: A Microsoft Entra specific component on Windows 10 or newer, that handles the device registration process for all device states.
- **Trusted Platform Module (TPM)**: A TPM is a hardware component built into a device that provides hardware-based security functions for user and device secrets. More details can be found in the article [Trusted Platform Module Technology Overview](https://learn.microsoft.com/en-us/windows/security/hardware-security/tpm/trusted-platform-module-overview).

### PRT Contents
PRTs contain "claims" found in most Microsoft Entra ID refresh tokens. They also contain some device-specific claims:
- **Device ID**: A PRT is issued to a user on a specific device. The device ID claim deviceID determines the device the PRT was issued to the user on. This claim is later issued to tokens obtained via the PRT. The device ID claim is used to determine authorization for Conditional Access based on device state or compliance.
- **Session key**: The session key is an encrypted symmetric key, generated by the Microsoft Entra authentication service, issued as part of the PRT. The session key acts as the proof of possession when a PRT is used to obtain tokens for other applications. Session key is rolled on Windows 10 or newer Microsoft Entra joined or Microsoft Entra hybrid joined devices if it's older than 30 days.


### Prerequisites
- An [Microsoft Entra joined device](https://learn.microsoft.com/en-us/entra/identity/devices/concept-directory-join).
- On-premises SSO requires line-of-sight communication with your on-premises AD DS domain controllers. If Microsoft Entra joined devices aren't connected to your organization's network, a VPN or other network infrastructure is required.
- Microsoft Entra Connect or Microsoft Entra Connect cloud sync: To synchronize default user attributes like SAM Account Name, Domain Name, and UPN. For more information, see the article [Attributes synchronized by Microsoft Entra Connect](https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/reference-connect-sync-attributes-synchronized#windows-10).

### Details
With a Microsoft Entra joined device, your users already have an SSO experience to the cloud apps in your environment. If your environment has Microsoft Entra ID and on-premises AD DS, you might want to expand the scope of your SSO experience to your on-premises Line Of Business (LOB) apps, file shares, and printers.

Microsoft Entra joined devices have no knowledge about your on-premises AD DS environment because they aren't joined to it. However, you can provide additional information about your on-premises AD to these devices with Microsoft Entra Connect.

Microsoft Entra Connect or Microsoft Entra Connect cloud sync synchronize your on-premises identity information to the cloud. As part of the synchronization process, on-premises user and domain information is synchronized to Microsoft Entra ID. When a user signs in to a Microsoft Entra joined device in a hybrid environment:
1. Microsoft Entra ID sends the details of the user's on-premises domain back to the device, along with the Primary Refresh Token.
2. The local security authority (LSA) service enables Kerberos and NTLM authentication on the device.

During an access attempt to an on-premises resource requesting Kerberos or NTLM, the device:
1. Sends the on-premises domain information and user credentials to the located DC to get the user authenticated.
2. Receives a Kerberos Ticket-Granting Ticket (TGT) or NTLM token based on the protocol the on-premises resource or application supports. If the attempt to get the Kerberos TGT or NTLM token for the domain fails, Credential Manager entries are tried, or the user might receive an authentication pop-up requesting credentials for the target resource. This failure can be related to a delay caused by a DCLocator timeout.

### Advantages and Benefits
With SSO, on a Microsoft Entra joined device you can:
- Access a UNC path on an AD member server
- Access an AD DS member web server configured for Windows-integrated security
If you want to manage your on-premises AD from a Windows device, install the <a target="_blank" href="https://www.microsoft.com/download/details.aspx?id=45520">Remote Server Administration Tools</a>, then use:
    - The Active Directory Users and Computers (ADUC) snap-in to administer all AD objects. However, you have to specify the domain that you want to connect to manually.
    - The DHCP snap-in to administer an AD-joined DHCP server. However, you might need to specify the DHCP server name or address.

### Notes
- You might have to adjust your [domain-based filtering](https://learn.microsoft.com/en-us/entra/identity/hybrid/connect/how-to-connect-sync-configure-filtering#domain-based-filtering) in Microsoft Entra Connect to ensure that the data about the required domains is synchronized if you have multiple domains.
- Apps and resources that depend on Active Directory machine authentication don't work because Microsoft Entra joined devices don't have a computer object in AD DS.
- You can't share files with other users on a Microsoft Entra joined device.
:::caution[Note]
Access to on-prem resources via SSO from an Entra join device is not supported in all cases.  For example, the following use cases are not supported:
- Because Microsoft Entra joined devices don't have a computer object in AD DS, apps and resources that depend on Active Directory **machine authentication** will not work
- File sharing between users on Microsoft Entra joined devices is not supported
- Applications that authenticate using legacy or NETBIOS names (i.e., "contoso\user") will fail, even if the legacy domain name can be resolved
:::
- Applications running on your Microsoft Entra joined device might authenticate users. They must use the implicit UPN or the NT4 type syntax with the domain FQDN name as the domain part, for example: user@contoso.corp.com or contoso.corp.com\user.
- If applications use the NETBIOS or legacy name like contoso\user, the errors the application gets would be either, NT error STATUS_BAD_VALIDATION_CLASS - 0xc00000a7, or Windows error ERROR_BAD_VALIDATION_CLASS - 1348 "The validation information class requested was invalid." This error happens even if you can resolve the legacy domain name.

### See also
- [How SSO to on-premises resources works on Microsoft Entra joined devices](https://learn.microsoft.com/en-us/entra/identity/devices/device-sso-to-on-premises-resources)